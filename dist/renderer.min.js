"use strict";function Init(){}function Camera(a){this.WIDTH=document.documentElement.clientWidth,this.HEIGHT=document.documentElement.clientHeight,this.VIEW_ANGLE=45,this.ASPECT=this.WIDTH/this.HEIGHT,this.NEAR=.1,this.FAR=1e3,a=a||{},Object.assign(this,a),THREE.PerspectiveCamera.call(this,this.VIEV_ANGLE,this.ASPECT,this.NEAR,this.FAR),this.position.z=200,this.mousePosition=new THREE.Vector3(0,0,1)}function ControlsHandler(a){if(!a.inputListener)throw new Error("No inputListener specified for the handler!");if(!a.logicBus)throw new Error("No logic bus specified for the handler!");Object.assign(this,a),this.inputListener=a.inputListener,this.logicBus=a.logicBus,this.oldInputState={},this.inputState={},this.camera=a.camera,this.mousePosition=new THREE.Vector3(0,0,1)}function Core(a){if(!a)throw new Error("Logic core initialization failure!");this.WIDTH=document.documentElement.clientWidth,this.HEIGHT=document.documentElement.clientHeight,this.FRAMERATE=60,this.renderTicks=0,this.logicWorker=a,this.resolutionCoefficient=1,this.initRenderer(),this.initAssets()}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function LogicBus(a){if(a=a||{},Object.assign(this,a),!this.logicWorker)throw new Error("No logicWorker object specified for LogicBus!");if(!this.actorManager)throw new Error("No actorManager object specified for LogicBus!");this.logicWorker.onmessage=this.handleMessage.bind(this)}function BaseActor(a,b){Object.assign(this,b),this.positionZ=10,this.position=new Float32Array([a.positionX||0,a.positionY||0]),this.logicPosition=new Float32Array([this.position[0],this.position[1]]),this.logicPreviousPosition=new Float32Array([this.position[0],this.position[1]]),this.angle=a.angle||0,this.logicAngle=this.angle,this.logicPreviousAngle=this.angle,this.updateFromLogic(a.positionX,a.positionY,a.angle),this.mesh=this.createMesh(),this.sprite=this.createSprite(),this.timer=0}function ChunkActor(){BaseActor.apply(this,arguments)}function EnemyMoltenProjectileActor(a){BaseActor.apply(this,arguments),this.colorR=1,this.colorG=.3,this.colorB=.1}function ExplosionActor(){BaseActor.apply(this,arguments),this.colorR=Math.random(),this.colorG=Math.random(),this.colorB=Math.random()}function MookActor(){BaseActor.apply(this,arguments)}function PillarActor(){BaseActor.apply(this,arguments)}function ShipActor(){BaseActor.apply(this,arguments),this.count=0}function ShipLaserProjectileActor(a){BaseActor.apply(this,arguments),this.colorR=.3,this.colorG=.3,this.colorB=1}function ShipPlasmaProjectileActor(a){BaseActor.apply(this,arguments),this.colorR=.3,this.colorG=1,this.colorB=.5}function WallActor(){BaseActor.apply(this,arguments)}function BaseMesh(a){THREE.Mesh.apply(this,arguments),this.angleOffset=0,a.scaleX=a.scaleX||1,a.scaleY=a.scaleY||1,a.scaleZ=a.scaleZ||1,a=a||{},Object.assign(this,a),this.scale.x=a.scaleX,this.scale.y=a.scaleY,this.scale.z=a.scaleZ}function ChunkMesh(a){BaseMesh.apply(this,arguments),this.angleOffset=Math.PI,a=a||{},a.geometry=ModelStore.get("chunk").geometry,a.material=ModelStore.get("chunk").material,Object.assign(this,a),this.castShadow=!0}function PillarMesh(a){BaseMesh.apply(this,arguments),this.angleOffset=Math.PI,a=a||{},a.geometry=new THREE.BoxGeometry(20,20,50,50),a.material=new THREE.MeshLambertMaterial({color:5263440}),Object.assign(this,a),this.castShadow=!0,this.receiveShadow=!0}function RavierMesh(a){BaseMesh.apply(this,arguments),a=a||{},a.geometry=ModelStore.get("ravier").geometry,a.material=ModelStore.get("ravier").material,Object.assign(this,a),this.castShadow=!0}function ShipMesh(a){BaseMesh.apply(this,arguments),this.angleOffset=Math.PI,a=a||{},a.geometry=ModelStore.get("ship").geometry,a.material=ModelStore.get("ship").material,Object.assign(this,a),this.castShadow=!0,this.receiveShadow=!0}function WallMesh(a){BaseMesh.apply(this,arguments),this.angleOffset=Math.PI,a=a||{},a.geometry=new THREE.BoxGeometry(800,2,50,50),a.material=new THREE.MeshLambertMaterial({color:5263440}),Object.assign(this,a),this.receiveShadow=!0}function BaseSprite(a){THREE.Sprite.apply(this,arguments),a=a||{},Object.assign(this,a)}function ProjectileSprite(a){BaseSprite.apply(this,arguments),a=a||{},a.material=ModelStore.get("projectile").material,Object.assign(this,a),this.scale.x=10,this.scale.y=10,this.scale.z=10}function BaseWeapon(a){}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function ActorFactory(a){var b;this.actorDependencies=a,this.actorMap=(b={},_defineProperty(b,ActorFactory.SHIP,ShipActor),_defineProperty(b,ActorFactory.MOOK,MookActor),_defineProperty(b,ActorFactory.WALL,WallActor),_defineProperty(b,ActorFactory.PILLAR,PillarActor),_defineProperty(b,ActorFactory.CHUNK,ChunkActor),_defineProperty(b,ActorFactory.PLASMAPROJECTILE,ShipPlasmaProjectileActor),_defineProperty(b,ActorFactory.MOLTENPROJECTILE,EnemyMoltenProjectileActor),_defineProperty(b,ActorFactory.LASERPROJECITLE,ShipLaserProjectileActor),b)}function ActorManager(a){if(a=a||{},this.storage=Object.create(null),this.scene=null,this.framerate=a.framerate||60,this.DELTA_SMOOTHNESS=0,Object.assign(this,a),!this.scene)throw new Error("No scene for Renderer ActorManager!");if(!this.particleManager)throw new Error("No particleManager for Renderer ActorManager!");this.factory=a.factory||new ActorFactory({particleManager:this.particleManager}),this.currentPhysicsTime=Date.now(),this.lastPhysicsTime=Date.now()-1}function ActorStorage(a){this.storage=Array.apply(null,Array(a)).map(function(){}),this.holes=Array.apply(null,Array(a)).map(function(){})}function CustomModelBuilder(){this.batch={},this.configuration=this.configure()}function ModelLoader(){this.batch={},Utils.mixin(this,THREE.EventDispatcher)}function ParticleConfigBuilder(){this.particleMaterialConfig={smokePuffAlpha:new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:(new THREE.TextureLoader).load("/gfx/smokePuffAlpha.png")}},vertexShader:ParticleShaders.vertexShader,fragmentShader:ParticleShaders.fragmentShader,transparent:!0}),particleAdd:new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:(new THREE.TextureLoader).load("/gfx/particleAdd.png")}},vertexShader:ParticleShaders.vertexShader,fragmentShader:ParticleShaders.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0}),mainExplosionAdd:new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:(new THREE.TextureLoader).load("/gfx/particleAdd.png")}},vertexShader:ParticleShaders.vertexShader,fragmentShader:ParticleShaders.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0})},this.particleGeneratorConfig={smokePuffAlpha:{material:this.particleMaterialConfig.smokePuffAlpha,maxParticles:1e3,positionZ:9},particleAddTrail:{material:this.particleMaterialConfig.particleAdd,maxParticles:7e3,positionZ:9},particleAddSplash:{material:this.particleMaterialConfig.particleAdd,maxParticles:3e3,positionZ:9},mainExplosionAdd:{material:this.particleMaterialConfig.particleAdd,maxParticles:500,positionZ:9}}}function ParticleGenerator(a){if(THREE.Points.apply(this,arguments),a=a||{},a.positionZ=a.positionZ||10,a.maxParticles=a.maxParticles||100,a.positionHiddenFromView=1e5,Object.assign(this,a),!this.material)throw new Error("No material defined for ParticleGenerator!");this.usedPoints=new Float32Array(this.maxParticles),this.nextPointer=0,this.geometry=this.createGeometry()}function ParticleManager(a){if(a=a||{},Object.assign(this,a),!this.scene)throw new Error("No scene specified for ParticleGenerator!");this.configBuilder=new ParticleConfigBuilder,this.configs=this.configBuilder.getAllConfigs(),this.generators={},this.buildGenerators()}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var gameCore;Init.prototype.start=function(){var a=new Worker("dist/logicInit.min.js"),b=new Core(a);gameCore=b};var Utils={makeRandomColor:function(){var a=["","",""];a.forEach(function(b,c){var d=Math.floor(256*Math.random()).toString(16);a[c]=1===d.length?"0"+d:d});var b="0x"+a.join("");return Number(b)},degToRad:function(a){return a*(Math.PI/180)},radToDeg:function(a){return a*(180/Math.PI)},getRandomFloat:function(a,b){if(a>b)throw"ERROR: getRandomFloat min > max";return Math.random()*(b-a)+a},getRandomInteger:function(a,b){if(a>b)throw"ERROR: getRandomInteger min > max";return Math.floor(Math.random()*(b-a+1)+a)},rand:function(a,b){return this.getRandomInteger(a,b)},mixin:function(a,b){for(var c in b.prototype)a[c]=b.prototype[c]},uptrunc:function(a){return 0>a?Math.floor(a):Math.ceil(a)},angleToVector:function(a,b){return b=b||0,[-1*Math.sin(a)*b,Math.cos(a)*b]},vectorAngleToPoint:function(a,b,c,d){var e=Math.atan2(c,a)-Math.atan2(d,b);return e=360*e/(2*Math.PI),0>e&&(e+=360),e},angleBetweenPoints:function(a,b,c,d){var e=d-b,f=c-a,g=Math.atan2(f,e);return g*=180/Math.PI,0>g&&(g=360+g),g}};Function.prototype.extend||(Function.prototype.extend=function(a){this.prototype=Object.create(a.prototype),this.prototype.constructor=a}),Camera.extend(THREE.PerspectiveCamera),Camera.prototype.update=function(){this.actor&&(this.position.x=this.actor.position[0],this.position.y=this.actor.position[1]);var a=this.inputListener.inputState;this.inputListener&&this.actor&&(this.inputListener.inputState.scrollUp&&(this.position.z+=a.scrollUp),this.inputListener.inputState.scrollDown&&(this.position.z-=a.scrollDown))},ControlsHandler.prototype.update=function(){Object.assign(this.oldInputState,this.inputState),Object.assign(this.inputState,this.inputListener.inputState),this.setSceneMousePosition();var a=!1;for(var b in this.inputState)this.inputState[b]!=this.oldInputState[b]&&(a=!0);a&&this.sendUpdate()},ControlsHandler.prototype.sendUpdate=function(){this.logicBus.postMessage("inputState",this.inputState)},ControlsHandler.prototype.setSceneMousePosition=function(){if(this.camera){this.mousePosition.x=this.inputState.mouseX,this.mousePosition.y=this.inputState.mouseY,this.mousePosition.z=1,this.mousePosition.unproject(this.camera);var a=this.mousePosition.z/(this.mousePosition.z-this.camera.position.z);this.inputListener.inputState.lookX=this.mousePosition.x+(this.camera.position.x-this.mousePosition.x)*a,this.inputListener.inputState.lookY=this.mousePosition.y+(this.camera.position.y-this.mousePosition.y)*a}},Core.prototype.initRenderer=function(){this.makeMainComponents(),this.stats=this.makeStatsWatcher(),this.startTime=Date.now(),this.attachToDom(this.renderer,this.stats)},Core.prototype.makeMainComponents=function(){this.renderer=this.makeRenderer(),this.inputListener=new InputListener(this.renderer.domElement),this.camera=this.makeCamera(this.inputListener),this.scene=this.makeScene(this.camera),this.particleManager=new ParticleManager({scene:this.scene}),this.actorManager=new ActorManager({scene:this.scene,particleManager:this.particleManager,core:this}),this.logicBus=new LogicBus({logicWorker:this.logicWorker,actorManager:this.actorManager}),this.controlsHandler=new ControlsHandler({inputListener:this.inputListener,logicBus:this.logicBus,camera:this.camera}),this.gameScene=new GameScene({core:this,scene:this.scene,logicBus:this.logicBus,actorManager:this.actorManager})},Core.prototype.makeStatsWatcher=function(){var a=new Stats;return a.domElement.style.position="absolute",a.domElement.style.top="0px",a},Core.prototype.attachToDom=function(a,b){document.body.appendChild(b.domElement),document.body.appendChild(a.domElement),this.autoResize()},Core.prototype.makeCamera=function(a){console.log("making camera");var b=new Camera({inputListener:a});return b},Core.prototype.makeScene=function(a){var b=new THREE.Scene;return b.add(a),b},Core.prototype.makeRenderer=function(){var a=new THREE.WebGLRenderer;return a.setSize(this.WIDTH,this.HEIGHT),a.shadowMap.enabled=!0,a.shadowMap.type=THREE.BasicShadowMap,a},Core.prototype.applyResolutionCoefficient=function(){this.renderer.setPixelRatio(this.resolutionCoefficient),this.resetRenderer(),this.resetCamera()},Core.prototype.autoResize=function(){var a=this,b=function(){a.resetRenderer(),a.resetCamera()};return window.addEventListener("resize",b,!1),{stop:function(){window.removeEventListener("resize",b)}}},Core.prototype.resetRenderer=function(){this.renderer.setSize(window.innerWidth,window.innerHeight)},Core.prototype.resetCamera=function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()},Core.prototype.initAssets=function(){this.modelLoader=new ModelLoader,this.modelLoader.addEventListener("loaded",this.onLoaded.bind(this)),this.modelLoader.loadModels(ModelList.models),this.customModelBuilder=new CustomModelBuilder,this.customModelBuilder.loadModels(),ModelStore.loadBatch(this.customModelBuilder.getBatch())},Core.prototype.onLoaded=function(a){ModelStore.loadBatch(this.modelLoader.getBatch()),this.modelLoader.clearBatch(),this.continueInit()},Core.prototype.continueInit=function(){this.gameScene.make(),setInterval(this.onEachSecond.bind(this),1e3);var a=new THREEx.RenderingLoop;a.add(this.render.bind(this)),a.start();var b=new THREEx.PhysicsLoop(120);b.add(this.controlsUpdate.bind(this)),b.start()},Core.prototype.onEachSecond=function(){this.renderTicks=0},Core.prototype.controlsUpdate=function(){this.inputListener.update(),this.controlsHandler.update()},Core.prototype.render=function(){this.gameScene.update(),this.actorManager.update(),this.particleManager.update(),this.camera.update(),this.renderTicks++,this.renderer.render(this.scene,this.camera),this.stats.update()};var InputListener=function a(b){function c(a,b){return function(){b.apply(a,arguments)}}function d(a){a.preventDefault()}_classCallCheck(this,a),this.scrollDuration=4,this.scrollFallOffPercent=10,this.domElement=void 0!==b?b:document,b&&this.domElement.setAttribute("tabindex",-1),this.inputState=Object.create(null),this.keys={81:"q",69:"e",87:"w",83:"s",65:"a",68:"d",37:"left",38:"up",39:"right",40:"down",1001:"scrollUp",1002:"scrollDown",1003:"mouseLeft",1004:"mouseRight"},Object.keys(this.keys).forEach(function(a){this.inputState[this.keys[a]]=0}.bind(this)),this.keydown=function(a){a.altKey||this.keys.hasOwnProperty(a.keyCode)&&(this.inputState[this.keys[a.keyCode]]=1)},this.keyup=function(a){this.keys.hasOwnProperty(a.keyCode)&&(this.inputState[this.keys[a.keyCode]]=0)},this.mouseWheel=function(a){this.inputState.scrollUp=a.deltaY>0?this.scrollDuration:0,this.inputState.scrollDown=a.deltaY<0?this.scrollDuration:0},this.mouseMove=function(a){this.inputState.mouseX=a.clientX/window.innerWidth*2-1,this.inputState.mouseY=2*-(a.clientY/window.innerHeight)+1},this.mouseDown=function(a){switch(a.button){case 0:this.inputState.mouseLeft=1;break;case 2:this.inputState.mouseRight=1}},this.mouseUp=function(a){switch(a.button){case 0:this.inputState.mouseLeft=0;break;case 2:this.inputState.mouseRight=0}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.update=function(){for(var a in this.inputState)switch(a){case"scrollUp":case"scrollDown":this.inputState[a]>0&&(this.inputState[a]*=1-this.scrollFallOffPercent/100),this.inputState[a]<.5&&(this.inputState[a]=0)}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("wheel",g,!1),this.domElement.removeEventListener("mousemove",g,!1),this.domElement.removeEventListener("mousedown",i,!1),this.domElement.removeEventListener("mouseup",j,!1),window.removeEventListener("keydown",e,!1),window.removeEventListener("keyup",f,!1)};var e=c(this,this.keydown),f=c(this,this.keyup),g=c(this,this.mouseWheel),h=c(this,this.mouseMove),i=c(this,this.mouseDown),j=c(this,this.mouseUp);this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("wheel",g,!1),this.domElement.addEventListener("mousemove",h,!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mouseup",j,!1),window.addEventListener("keydown",e,!1),window.addEventListener("keyup",f,!1)};LogicBus.prototype.handleMessage=function(a){switch(a.data.type){case"updateActors":this.actorManager.updateFromLogic(a.data);break;case"attachPlayer":this.actorManager.attachPlayer(a.data.actorId)}},LogicBus.prototype.postMessage=function(a,b){b.type=a,this.logicWorker.postMessage(b)},BaseActor.prototype.update=function(a){this.timer++,this.position[0]=this.logicPreviousPosition[0]+a*(this.logicPosition[0]-this.logicPreviousPosition[0]),this.position[1]=this.logicPreviousPosition[1]+a*(this.logicPosition[1]-this.logicPreviousPosition[1]),this.angle=this.logicPreviousAngle+a*(this.logicAngle-this.logicPreviousAngle),this.mesh&&this.mesh.update(),this.sprite&&this.sprite.update(),this.customUpdate()},BaseActor.prototype.customUpdate=function(){},BaseActor.prototype.updateFromLogic=function(a,b,c){this.logicPreviousPosition[0]=this.logicPosition[0],this.logicPreviousPosition[1]=this.logicPosition[1],this.logicPreviousAngle=this.logicAngle,this.logicPosition[0]=a||0,this.logicPosition[1]=b||0,this.logicAngle=c||0},BaseActor.prototype.createMesh=function(){return null},BaseActor.prototype.createSprite=function(){return null},BaseActor.prototype.addToScene=function(a){this.mesh&&a.add(this.mesh),this.sprite&&a.add(this.sprite)},BaseActor.prototype.removeFromScene=function(a){this.mesh&&a.remove(this.mesh),this.sprite&&a.remove(this.sprite)},BaseActor.prototype.onDeath=function(){},BaseActor.prototype.onSpawn=function(){},ChunkActor.extend(BaseActor),ChunkActor.prototype.createMesh=function(){return new ChunkMesh({actor:this,scaleX:Utils.rand(5,10)/10,scaleY:Utils.rand(5,10)/10,scaleZ:Utils.rand(5,10)/10})},ChunkActor.prototype.customUpdate=function(){this.timer%Utils.rand(5,10)===0&&this.particleManager.createParticle("smokePuffAlpha",{positionX:this.position[0]+Utils.rand(-2,2),positionY:this.position[1]+Utils.rand(-2,2),colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,5),alpha:.6,alphaMultiplier:.9,particleVelocity:Utils.rand(0,1)/10,particleAngle:Utils.rand(0,360),lifeTime:60})},ChunkActor.prototype.onDeath=function(){for(var a=0;20>a;a++)this.particleManager.createParticle("smokePuffAlpha",{positionX:this.position[0]+Utils.rand(-2,2),positionY:this.position[1]+Utils.rand(-2,2),colorR:1,colorG:1,colorB:1,scale:Utils.rand(1,3),alpha:.6,alphaMultiplier:.9,particleVelocity:Utils.rand(0,1)/10,particleAngle:Utils.rand(0,360),lifeTime:60});this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:.3,colorB:.1,scale:20,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:40}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:15,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:40})},EnemyMoltenProjectileActor.extend(BaseActor),EnemyMoltenProjectileActor.prototype.customUpdate=function(){for(var a=0;3>a;a++){var b=Utils.angleToVector(this.angle,.3*-a);this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0]+b[0],positionY:this.position[1]+b[1],colorR:1,colorG:1,colorB:1,scale:2-.3*a,alpha:1-.19*a,alphaMultiplier:.8,particleVelocity:1,particleAngle:this.angle,lifeTime:1})}this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:this.colorR,colorG:this.colorG,colorB:this.colorB,scale:7,alpha:.4,alphaMultiplier:.6,particleVelocity:1,particleAngle:this.angle,lifeTime:2})},EnemyMoltenProjectileActor.prototype.onDeath=function(){for(var a=0;20>a;a++)this.particleManager.createParticle("smokePuffAlpha",{positionX:this.position[0]+Utils.rand(-2,2),positionY:this.position[1]+Utils.rand(-2,2),colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:Utils.rand(1,3),alpha:.6,alphaMultiplier:.9,particleVelocity:Utils.rand(0,1)/10,particleAngle:Utils.rand(0,360),lifeTime:60});this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:35,alpha:1,alphaMultiplier:.2,particleVelocity:0,particleAngle:0,lifeTime:10}),this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:8,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:15}),this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:10,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:20})},EnemyMoltenProjectileActor.prototype.onSpawn=function(){this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:30,alpha:.8,alphaMultiplier:.2,particleVelocity:0,particleAngle:0,lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:15,alpha:.4,alphaMultiplier:.7,particleVelocity:2,particleAngle:this.angle,lifeTime:10})},ExplosionActor.extend(BaseActor),ExplosionActor.prototype.customUpdate=function(){for(var a=0;10>a;a++)this.particleManager.createParticle("smokePuffAlpha",this.position[0]+Utils.rand(-8,8),this.position[1]+Utils.rand(-8,8),.3*this.colorR+.7,.3*this.colorG+.7,.3*this.colorB+.7,Utils.rand(5,20),.5,60);this.particleManager.createParticle("particleAddTrail",this.position[0],this.position[1],this.colorR,this.colorG,this.colorB,30,1,50),this.particleManager.createParticle("particleAddTrail",this.position[0],this.position[1],1,1,1,25,1,50),this.particleManager.createParticle("particleAddTrail",this.position[0],this.position[1],this.colorR,this.colorG,this.colorB,80,.3,50)},MookActor.extend(BaseActor),MookActor.prototype.createMesh=function(){return new ShipMesh({actor:this,scaleX:1,scaleY:1,scaleZ:1})},MookActor.prototype.onDeath=function(){for(var a=0;100>a;a++)this.particleManager.createParticle("smokePuffAlpha",{positionX:this.position[0]+Utils.rand(-2,2),positionY:this.position[1]+Utils.rand(-2,2),colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,15),alpha:Utils.rand(0,3)/10+.3,alphaMultiplier:.95,particleVelocity:Utils.rand(0,4)/10,particleAngle:Utils.rand(0,360),lifeTime:120});this.particleManager.createParticle("mainExplosionAdd",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:200,alpha:1,alphaMultiplier:.4,particleVelocity:0,particleAngle:0,lifeTime:20}),this.particleManager.createParticle("mainExplosionAdd",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:40,alpha:1,alphaMultiplier:.95,particleVelocity:0,particleAngle:0,lifeTime:80}),this.particleManager.createParticle("mainExplosionAdd",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:.6,colorB:.2,scale:60,alpha:1,alphaMultiplier:.95,particleVelocity:0,particleAngle:0,lifeTime:80})},PillarActor.extend(BaseActor),PillarActor.prototype.createMesh=function(){return new PillarMesh({actor:this})},ShipActor.extend(BaseActor),ShipActor.prototype.createMesh=function(){return new RavierMesh({actor:this,scaleX:3,scaleY:3,scaleZ:3})},ShipActor.prototype.customUpdate=function(){this.doEngineGlow()},ShipActor.prototype.doBank=function(){this.logicPreviousAngle<this.angle&&(this.mesh.rotation.x=Utils.degToRad(-15)),this.logicPreviousAngle>this.angle&&(this.mesh.rotation.x=Utils.degToRad(15)),this.logicPreviousAngle===this.angle&&(this.mesh.rotation.x=0)},ShipActor.prototype.doEngineGlow=function(){this.inputListener.inputState.w&&(this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(10,15),alpha:.4,alphaMultiplier:1,particleVelocity:-5,particleAngle:this.angle+Utils.degToRad(15),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(10,15),alpha:.4,alphaMultiplier:1,particleVelocity:-5,particleAngle:this.angle-Utils.degToRad(15),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(3,4),alpha:1,alphaMultiplier:1,particleVelocity:-5,particleAngle:this.angle+Utils.degToRad(15),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(3,4),alpha:1,alphaMultiplier:1,particleVelocity:-5,particleAngle:this.angle-Utils.degToRad(15),lifeTime:1})),this.inputListener.inputState.a&&(this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(6,11),alpha:.4,alphaMultiplier:1,particleVelocity:-4,particleAngle:this.angle+Utils.degToRad(40),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,3),alpha:1,alphaMultiplier:1,particleVelocity:-4,particleAngle:this.angle+Utils.degToRad(40),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(6,11),alpha:.4,alphaMultiplier:1,particleVelocity:-6,particleAngle:this.angle+Utils.degToRad(170),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,3),alpha:1,alphaMultiplier:1,particleVelocity:-6,particleAngle:this.angle+Utils.degToRad(170),lifeTime:1})),this.inputListener.inputState.d&&(this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(6,11),alpha:.4,alphaMultiplier:1,particleVelocity:-4,particleAngle:this.angle-Utils.degToRad(40),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,3),alpha:1,alphaMultiplier:1,particleVelocity:-4,particleAngle:this.angle-Utils.degToRad(40),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(6,11),alpha:.4,alphaMultiplier:1,particleVelocity:-6,particleAngle:this.angle-Utils.degToRad(170),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,3),alpha:1,alphaMultiplier:1,particleVelocity:-6,particleAngle:this.angle-Utils.degToRad(170),lifeTime:1})),this.inputListener.inputState.s&&(this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.5,colorG:.6,colorB:1,scale:Utils.rand(10,15),alpha:.4,alphaMultiplier:1,particleVelocity:-7,particleAngle:this.angle+Utils.degToRad(180),lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:Utils.rand(3,4),alpha:1,alphaMultiplier:1,particleVelocity:-7,particleAngle:this.angle+Utils.degToRad(180),lifeTime:1}))},ShipActor.prototype.onDeath=function(){for(var a=0;100>a;a++)this.particleManager.createParticle("smokePuffAlpha",{positionX:this.position[0]+Utils.rand(-2,2),positionY:this.position[1]+Utils.rand(-2,2),colorR:1,colorG:1,colorB:1,scale:Utils.rand(2,15),alpha:Utils.rand(0,3)/10+.3,alphaMultiplier:.95,particleVelocity:Utils.rand(0,4)/10,particleAngle:Utils.rand(0,360),lifeTime:120});this.particleManager.createParticle("mainExplosionAdd",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:200,alpha:1,alphaMultiplier:.4,particleVelocity:0,particleAngle:0,lifeTime:20}),this.particleManager.createParticle("mainExplosionAdd",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:40,alpha:1,alphaMultiplier:.95,particleVelocity:0,particleAngle:0,lifeTime:80}),this.particleManager.createParticle("mainExplosionAdd",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:.6,colorB:.2,scale:60,alpha:1,alphaMultiplier:.95,particleVelocity:0,particleAngle:0,lifeTime:80})},ShipLaserProjectileActor.extend(BaseActor),ShipLaserProjectileActor.prototype.customUpdate=function(){for(var a=0;20>a;a++){var b=Utils.angleToVector(this.angle,.4*-a);this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0]+b[0],positionY:this.position[1]+b[1],colorR:1,colorG:1,colorB:1,scale:1,alpha:1-.05*a,alphaMultiplier:.8,particleVelocity:1,particleAngle:this.angle,lifeTime:1})}for(var a=0;5>a;a++){var b=Utils.angleToVector(this.angle,1.8*-a);this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0]+b[0],positionY:this.position[1]+b[1],colorR:this.colorR,colorG:this.colorG,colorB:this.colorB,scale:5,alpha:.7-.1*a,alphaMultiplier:.6,particleVelocity:2,particleAngle:this.angle,lifeTime:1})}},ShipLaserProjectileActor.prototype.onDeath=function(){for(var a=0;100>a;a++)this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:1,alpha:1,alphaMultiplier:.9,particleVelocity:Utils.rand(1,6)/10,particleAngle:Utils.rand(0,360),lifeTime:Utils.rand(20,100)});this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:30,alpha:1,alphaMultiplier:.2,particleVelocity:0,particleAngle:0,lifeTime:10}),this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:5,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:15}),this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:this.colorR,colorG:this.colorG,colorB:this.colorB,scale:8,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:20})},ShipLaserProjectileActor.prototype.onSpawn=function(){this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:20,alpha:.8,alphaMultiplier:.2,particleVelocity:0,particleAngle:0,lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:8,alpha:1,alphaMultiplier:.7,particleVelocity:3,particleAngle:this.angle,lifeTime:10})},ShipPlasmaProjectileActor.extend(BaseActor),ShipPlasmaProjectileActor.prototype.customUpdate=function(){for(var a=0;5>a;a++){var b=Utils.angleToVector(this.angle,.7*-a);this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0]+b[0],positionY:this.position[1]+b[1],colorR:1,colorG:1,colorB:1,scale:3-.4*a,alpha:1-.19*a,alphaMultiplier:.8,particleVelocity:1,particleAngle:this.angle,lifeTime:1})}this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:this.colorR,colorG:this.colorG,colorB:this.colorB,scale:10,alpha:.5,alphaMultiplier:.4,particleVelocity:1,particleAngle:this.angle,lifeTime:2})},ShipPlasmaProjectileActor.prototype.onDeath=function(){for(var a=0;20>a;a++)this.particleManager.createParticle("smokePuffAlpha",{positionX:this.position[0]+Utils.rand(-3,3),positionY:this.position[1]+Utils.rand(-3,3),
colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:Utils.rand(1,3),alpha:.6,alphaMultiplier:.9,particleVelocity:Utils.rand(0,1)/10,particleAngle:Utils.rand(0,360),lifeTime:60});this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:40,alpha:1,alphaMultiplier:.2,particleVelocity:0,particleAngle:0,lifeTime:10}),this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:1,colorG:1,colorB:1,scale:10,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:15}),this.particleManager.createParticle("particleAddSplash",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:15,alpha:1,alphaMultiplier:.8,particleVelocity:0,particleAngle:0,lifeTime:20})},ShipPlasmaProjectileActor.prototype.onSpawn=function(){this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:30,alpha:.8,alphaMultiplier:.2,particleVelocity:0,particleAngle:0,lifeTime:1}),this.particleManager.createParticle("particleAddTrail",{positionX:this.position[0],positionY:this.position[1],colorR:.3*this.colorR+.7,colorG:.3*this.colorG+.7,colorB:.3*this.colorB+.7,scale:15,alpha:.4,alphaMultiplier:.7,particleVelocity:2,particleAngle:this.angle,lifeTime:10})},WallActor.extend(BaseActor),WallActor.prototype.createMesh=function(){return new WallMesh({actor:this})},BaseMesh.extend(THREE.Mesh),BaseMesh.prototype.update=function(){this.actor&&(this.position.x=this.actor.position[0],this.position.y=this.actor.position[1],this.position.z=this.actor.positionZ,this.rotation.z=this.actor.angle+this.angleOffset)},ChunkMesh.extend(BaseMesh),PillarMesh.extend(BaseMesh),RavierMesh.extend(BaseMesh),ShipMesh.extend(BaseMesh),WallMesh.extend(BaseMesh),BaseSprite.extend(THREE.Sprite),BaseSprite.prototype.update=function(){this.actor&&(this.position.x=this.actor.position[0],this.position.y=this.actor.position[1],this.position.z=this.actor.positionZ)},ProjectileSprite.extend(BaseSprite),ActorFactory.SHIP=1,ActorFactory.MOOK=2,ActorFactory.PILLAR=3,ActorFactory.WALL=4,ActorFactory.CHUNK=5,ActorFactory.PLASMAPROJECTILE=100,ActorFactory.MOLTENPROJECTILE=101,ActorFactory.LASERPROJECITLE=102,ActorFactory.prototype.create=function(a){if(!this.actorMap[a.classId])throw new Error("Cannot create actor. Bad configuration!".config);return new this.actorMap[a.classId](a,this.actorDependencies)},ActorManager.prototype.update=function(){var a=(Date.now()-this.currentPhysicsTime)/(this.currentPhysicsTime-this.lastPhysicsTime);for(var b in this.storage)this.storage[b].update(isFinite(a)?Math.min(a,1):0)},ActorManager.prototype.updateFromLogic=function(a){this.lastPhysicsTime=this.currentPhysicsTime,this.currentPhysicsTime=Date.now();for(var b=a.transferArray,c=a.deadActors,d=0;d<a.length;d++){var e=this.storage[b[5*d]];e?e.updateFromLogic(b[5*d+2],b[5*d+3],b[5*d+4]):b[5*d+1]>0&&this.createActor({actorId:b[5*d],classId:b[5*d+1],positionX:b[5*d+2],positionY:b[5*d+3],angle:b[5*d+4]})}for(var d=0;d<c.length;d++)this.deleteActor(c[d])},ActorManager.prototype.createActor=function(a){var b=this.factory.create(a);this.actorRequestingPlayer&&this.actorRequestingPlayer===a.actorId&&(this.core.camera.actor=b,this.core.gameScene.actor=b,b.inputListener=this.core.inputListener),this.storage[a.actorId]=b,b.addToScene(this.scene),b.onSpawn()},ActorManager.prototype.attachPlayer=function(a){this.storage[a]?this.core.camera.actor=this.storage[a]:this.actorRequestingPlayer=a},ActorManager.prototype.deleteActor=function(a){var b=this.storage[a];b&&(b.onDeath(),b.removeFromScene(this.scene)),delete this.storage[a]},CustomModelBuilder.prototype.configure=function(){return{projectile:{material:new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture("/gfx/elongatedParticleAdd.png"),color:16777215,blending:THREE.AdditiveBlending})},chunk:{material:new THREE.MeshPhongMaterial({color:8947848,map:THREE.ImageUtils.loadTexture("/models/chunk.png")})},orangeChunk:{material:new THREE.MeshPhongMaterial({color:8934690,map:THREE.ImageUtils.loadTexture("/models/chunk.png")})}}},CustomModelBuilder.prototype.loadModels=function(){var a=this;Object.keys(this.configuration).forEach(function(b){a.batch[b]={geometry:a.configuration[b].geometry,material:a.configuration[b].material}})},CustomModelBuilder.prototype.getBatch=function(){return this.batch},ModelLoader.prototype.clearBatch=function(){this.batch={}};var ModelList={models:["/models/ship.json","/models/ravier.json","/models/chunk.json"]};ModelLoader.prototype.loadModels=function(a){var b=this;if(!a)throw"ERROR: No model paths have been specified for the loader!";var c=new THREE.JSONLoader;Promise.all(a.map(function(a){var d=new Promise(function(d,e){c.load(a,function(c,e){b.batch[b.getModelName(a)]={geometry:c,material:e},d()},b.getDefaultTexturePath(a))});return d})).then(this.doneAction.bind(this))},ModelLoader.prototype.getBatch=function(){return this.batch},ModelLoader.prototype.clearBatch=function(){this.batch={}},ModelLoader.prototype.doneAction=function(){this.dispatchEvent({type:"loaded"})},ModelLoader.prototype.getModelName=function(a){var b=a.split(".")[0].split("/").pop();if(!b)throw"ERROR: Bad model path: "+a;return b},ModelLoader.prototype.getDefaultTexturePath=function(a){return a.replace("json","png")};var ModelStore={_materials:{},_geometries:{},get:function(a){return{geometry:this._geometries[a],material:this._materials[a]}},loadBatch:function(a){Object.keys(a).forEach(function(b){this._addGeometry(b,a[b].geometry),this._addMaterial(b,a[b].material)}.bind(this))},_addGeometry:function(a,b){this._geometries[a]=b},_addMaterial:function(a,b){if(!b)throw"ERROR - no material specified";this._materials[a]=b instanceof Array?b[0]:b}};ParticleConfigBuilder.prototype.getConfig=function(a){return this.particleGeneratorConfig[a]},ParticleConfigBuilder.prototype.getAllConfigs=function(){return this.particleGeneratorConfig},ParticleGenerator.extend(THREE.Points),ParticleGenerator.prototype.createGeometry=function(){for(var a=new THREE.BufferGeometry,b=new Float32Array(3*this.maxParticles),c=new Float32Array(3*this.maxParticles),d=new Float32Array(2*this.maxParticles),e=new Float32Array(2*this.maxParticles),f=new Float32Array(1*this.maxParticles),g=new Float32Array(1*this.maxParticles),h=0;h<this.maxParticles;h++)b[3*h+0]=Utils.rand(-this.positionHiddenFromView,this.positionHiddenFromView),b[3*h+1]=Utils.rand(-this.positionHiddenFromView,this.positionHiddenFromView),b[3*h+2]=this.positionZ,g[h]=-1;return a.addAttribute("position",new THREE.BufferAttribute(b,3)),a.addAttribute("color",new THREE.BufferAttribute(c,3)),a.addAttribute("speed",new THREE.BufferAttribute(d,2)),a.addAttribute("alpha",new THREE.BufferAttribute(e,2)),a.addAttribute("scale",new THREE.BufferAttribute(f,1)),a.lifeTime=g,this.positionHandle=a.attributes.position.array,this.alphaHandle=a.attributes.alpha.array,this.colorHandle=a.attributes.color.array,this.scaleHandle=a.attributes.scale.array,this.speedHandle=a.attributes.speed.array,a},ParticleGenerator.prototype.create=function(a){var b=this.nextPointer;this.nextPointer++,this.nextPointer>this.maxParticles&&(this.nextPointer=0),this.initParticle(b,a)},ParticleGenerator.prototype.deactivate=function(a){this.positionHandle[3*a]=this.positionHiddenFromView,this.positionHandle[3*a+1]=this.positionHiddenFromView},ParticleGenerator.prototype.update=function(){for(var a=0;a<this.maxParticles;a++)this.updateParticle(a);this.geometry.attributes.alpha.needsUpdate=!0,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.attributes.scale.needsUpdate=!0},ParticleGenerator.prototype.updateParticle=function(a){var b=this.geometry.lifeTime;0===b[a]?this.deactivate(a):(b[a]-=1,this.alphaHandle[2*a]*=this.alphaHandle[2*a+1],this.positionHandle[3*a]+=this.speedHandle[2*a],this.positionHandle[3*a+1]+=this.speedHandle[2*a+1])},ParticleGenerator.prototype.initParticle=function(a,b){this.positionHandle[3*a]=b.positionX,this.positionHandle[3*a+1]=b.positionY,this.colorHandle[3*a]=b.colorR,this.colorHandle[3*a+1]=b.colorG,this.colorHandle[3*a+2]=b.colorB,this.scaleHandle[a]=b.scale,this.alphaHandle[2*a]=b.alpha,this.alphaHandle[2*a+1]=b.alphaMultiplier,this.speedHandle[2*a]=-1*Math.sin(b.particleAngle)*b.particleVelocity,this.speedHandle[2*a+1]=Math.cos(b.particleAngle)*b.particleVelocity,this.geometry.lifeTime[a]=b.lifeTime},ParticleManager.prototype.buildGenerators=function(){var a=this;Object.keys(this.configs).forEach(function(b){var c=new ParticleGenerator(a.configs[b]);a.generators[b]=c,a.scene.add(c)})},ParticleManager.prototype.getGenerator=function(a){return this.generators[a]},ParticleManager.prototype.update=function(){for(var a in this.generators)this.generators[a].update()},ParticleManager.prototype.createParticle=function(a,b){this.generators[a].create(b)};var ParticleShaders={vertexShader:"         attribute float alpha;         attribute vec3 color;         varying float vAlpha;         varying vec3 vColor;         attribute float scale;         void main() {             vAlpha = alpha;             vColor = color;             vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );             gl_PointSize =  scale * (1000.0 / - mvPosition.z) ;             gl_Position = projectionMatrix * mvPosition;         }",fragmentShader:"         uniform sampler2D map;         varying vec3 vColor;         varying float vAlpha;         void main() { 			gl_FragColor = vec4(vColor, vAlpha) * texture2D( map, gl_PointCoord );         }     "},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GameScene=function(){function a(b){_classCallCheck(this,a),Object.assign(this,b),this.lightCounter=0}return _createClass(a,[{key:"makeWalls",value:function(){for(var a,b=[],c=new THREE.MeshLambertMaterial({color:16777215}),d=new THREE.BoxGeometry(5,50,5,1,1,1),e=0;100>e;e++)a=new THREE.Mesh(d,c),a.position.x=Utils.rand(-200,200),a.position.y=Utils.rand(-200,200),a.position.z=Utils.rand(0,2),a.rotateZ(Utils.degToRad(Utils.rand(0,360))),b.push(a);var f=new THREE.Geometry;return b.forEach(function(a){a.updateMatrix(),f.merge(a.geometry,a.matrix)}),new THREE.Mesh(f,c)}},{key:"make",value:function(){var a=new THREE.Geometry,b=THREE.ImageUtils.loadTexture("/models/floor.png");b.wrapS=b.wrapT=THREE.RepeatWrapping,b.repeat.set(10,10);var c=new THREE.PlaneGeometry(800,800,2,2),d=new THREE.MeshPhongMaterial({color:8947848,map:b}),e=new THREE.Mesh(c,d);e.updateMatrix(),a.merge(e.geometry,e.matrix);var f=this.makeWalls();a.merge(f.geometry,f.matrix);var g=new THREE.Mesh(a,d);g.receiveShadow=!0,g.castShadow=!0,g.matrixAutoUpdate=!1,g.updateMatrix(),this.scene.add(g);var h=new THREE.DirectionalLight(16777215,.2);h.position.set(2,2,10),this.scene.add(h),this.pointLight=new THREE.PointLight(16777215,1),this.pointLight.distance=200,this.pointLight.castShadow=!0,this.pointLight.shadowCameraNear=1,this.pointLight.shadowCameraFar=200,this.pointLight.shadowMapWidth=2048,this.pointLight.shadowMapHeight=2048,this.pointLight.shadowBias=0,this.pointLight.shadowDarkness=.4,this.pointLight.position.set(0,0,50),this.scene.add(this.pointLight)}},{key:"update",value:function(){if(this.actor){var a=Utils.angleToVector(this.actor.angle,20);this.pointLight.position.x=this.actor.position[0]+a[0],this.pointLight.position.y=this.actor.position[1]+a[1]}}}]),a}();
//# sourceMappingURL=renderer.min.map