{"version":3,"sources":["../../src/Core.js"],"names":[],"mappings":"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","file":"Core.js","sourcesContent":["class Core {\n    constructor() {\n        this.WIDTH = document.documentElement.clientWidth;\n        this.HEIGHT = document.documentElement.clientHeight;\n        this.FRAMERATE = 60;\n        this.logicTicks = 0;\n        this.renderTicks = 0;\n    }\n\n    run() {\n        this.loadAssets();\n    }\n\n    loadAssets() {\n        this.modelLoader = new ModelLoader(ModelList.models);\n        this.modelLoader.addEventListener('loaded', this.onLoaded.bind(this));\n        this.modelLoader.loadModels();\n    }\n\n    onLoaded(event) {\n        ModelStore.loadBatch(this.modelLoader.getBatch());\n        this.modelLoader.clearBatch();\n        this.runAfterAssetsLoaded();\n    }\n\n    makeManagers(){\n        this.masterManager = new MasterManager();\n        this.masterManager.add(new Manager(this.scene, 'ship'), 'ship');\n        this.masterManager.add(new Manager(this.scene), 'light');\n    }\n\n    runAfterAssetsLoaded(){\n        this.makeManagers();\n\n        this.gameLoop = new GameLoop(this.controls, this.camera);\n\n        var actor = new PlayerActor(this.controls);\n        this.camera.actor = actor;\n        this.masterManager.get('ship').add(actor);\n\n        this.gameScene.make();\n\n        setInterval(()=>{\n            console.log('logicTicks:', this.logicTicks, ' renderTicks: ', this.renderTicks);\n            this.logicTicks = 0;\n            this.renderTicks = 0;\n        }, 1000);\n\n        var logicLoop = new THREEx.RenderingLoop();\n        logicLoop.add(this.processGameLogic.bind(this));\n\n        var renderLoop = new THREEx.RenderingLoop();\n        renderLoop.add(this.render.bind(this));\n\n        logicLoop.start();\n        renderLoop.start();\n    }\n\n    setRenderer() {\n        this.renderer = this.makeRenderer();\n        this.camera = this.makeCamera();\n        this.scene = this.makeScene();\n        this.scene.add(this.camera);\n        this.controls = new TopDownControls( this.camera );\n        this.controls.domElement = this.renderer.domElement;\n        this.autoResize(this.renderer, this.camera);\n        this.stats = new Stats();\n        this.stats.domElement.style.position = 'absolute';\n        this.stats.domElement.style.top = '0px';\n        this.gameScene = new GameScene(this, this.scene);\n        document.body.appendChild( this.renderer.domElement );\n        document.body.appendChild( this.stats.domElement );\n    }\n\n    makeCamera() {\n        var camera = new Camera();\n        return camera;\n    }\n\n    makeScene(camera) {\n        return new THREE.Scene();\n    }\n\n    makeRenderer() {\n        var renderer = new THREE.WebGLRenderer();\n        renderer.setSize(this.WIDTH, this.HEIGHT);\n        renderer.shadowMap.enabled = true;\n        renderer.shadowMap.type = THREE.BasicShadowMap;\n\n        return renderer;\n    }\n\n    processGameLogic(){\n        this.logicTicks++;\n        this.gameLoop.update();\n        this.masterManager.update();\n        this.gameScene.update();\n        this.controls.update();\n        this.camera.update();\n    }\n\n    render(){\n        this.renderTicks++;\n        this.renderer.render(this.scene, this.camera);\n        this.stats.update();\n    }\n\n    autoResize(renderer, camera) {\n        var callback = function () {\n            renderer.setSize(window.innerWidth, window.innerHeight);\n            camera.aspect = window.innerWidth / window.innerHeight;\n            camera.updateProjectionMatrix();\n        };\n        window.addEventListener('resize', callback, false);\n        return {\n            stop: function () {\n                window.removeEventListener('resize', callback);\n            }\n        };\n    }\n\n    rendererReport(){\n        if(!this.time){\n            this.time = 0;\n        }\n\n        this.time++;\n\n        if(this.time > 120){\n            this.time = 0;\n            console.info(this.renderer.info.render.faces);\n            console.info(this.renderer.info.memory.textures);\n            console.info(this.renderer.info.render.vertices);\n            console.info(this.renderer.info.memory.geometries);\n            console.info(this.renderer.info.render.calls);\n        }\n    }\n}\n"]}