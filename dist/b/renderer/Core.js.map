{"version":3,"sources":["../../../src/renderer/Core.js"],"names":[],"mappings":"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","file":"Core.js","sourcesContent":["function Core(logicCore){\r\n    if(!logicCore) throw new Error('Logic core initialization failure!');\r\n    this.WIDTH = document.documentElement.clientWidth;\r\n    this.HEIGHT = document.documentElement.clientHeight;\r\n    this.FRAMERATE = 60;\r\n    this.renderTicks = 0;\r\n    this.logicWorker = logicCore;\r\n    this.resolutionCoefficient = 1;\r\n\r\n    this.initRenderer();\r\n    this.initAssets();\r\n}\r\n\r\n\r\nCore.prototype.initRenderer = function(){\r\n    this.renderer = this.makeRenderer();\r\n\r\n    this.camera = this.makeCamera();\r\n    this.scene = this.makeScene();\r\n    this.scene.add(this.camera);\r\n    this.autoResize();\r\n    this.stats = new Stats();\r\n    this.stats.domElement.style.position = 'absolute';\r\n    this.stats.domElement.style.top = '0px';\r\n    this.actorManager = new ActorManager({scene: this.scene, core: this});\r\n    this.logicBus = new LogicBus({logicWorker: this.logicWorker, actorManager: this.actorManager});\r\n\r\n    this.inputListener = new InputListener( this.renderer.domElement );\r\n    this.controlsHandler = new ControlsHandler({inputListener: this.inputListener, logicBus: this.logicBus});\r\n\r\n    this.camera.inputListener = this.inputListener;\r\n\r\n    this.gameScene = new GameScene({\r\n        core: this,\r\n        scene: this.scene,\r\n        logicBus: this.logicBus,\r\n        actorManager: this.actorManager\r\n    });\r\n\r\n    document.body.appendChild( this.renderer.domElement );\r\n    document.body.appendChild( this.stats.domElement );\r\n};\r\n\r\nCore.prototype.makeCamera = function() {\r\n    console.log('making camera');\r\n    var camera = new Camera({controls: this.controls});\r\n    return camera;\r\n};\r\n\r\nCore.prototype.makeScene = function(camera) {\r\n    return new THREE.Scene();\r\n};\r\n\r\nCore.prototype.makeRenderer = function() {\r\n    var renderer = new THREE.WebGLRenderer();\r\n    renderer.setSize(this.WIDTH, this.HEIGHT);\r\n    return renderer;\r\n};\r\n\r\nCore.prototype.applyResolutionCoefficient = function(){\r\n    this.renderer.setPixelRatio(this.resolutionCoefficient);\r\n    this.resetRenderer();\r\n    this.resetCamera();\r\n};\r\n\r\nCore.prototype.autoResize = function() {\r\n    var callback = () => {\r\n        this.resetRenderer();\r\n        this.resetCamera();\r\n    };\r\n    window.addEventListener('resize', callback, false);\r\n    return {\r\n        stop: () => {\r\n            window.removeEventListener('resize', callback);\r\n        }\r\n    };\r\n};\r\n\r\nCore.prototype.resetRenderer = function(){\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n};\r\n\r\nCore.prototype.resetCamera = function(){\r\n    this.camera.aspect = window.innerWidth / window.innerHeight;\r\n    this.camera.updateProjectionMatrix();\r\n};\r\n\r\nCore.prototype.initAssets = function() {\r\n    this.modelLoader = new ModelLoader(ModelList.models);\r\n    this.modelLoader.addEventListener('loaded', this.onLoaded.bind(this));\r\n    this.modelLoader.loadModels();\r\n};\r\n\r\nCore.prototype.onLoaded = function(event) {\r\n    ModelStore.loadBatch(this.modelLoader.getBatch());\r\n    this.modelLoader.clearBatch();\r\n    this.continueInit();\r\n};\r\n\r\nCore.prototype.continueInit = function(){\r\n    this.gameScene.make();\r\n\r\n    setInterval(this.onEachSecond.bind(this), 1000);\r\n\r\n    var renderLoop = new THREEx.RenderingLoop();\r\n    renderLoop.add(this.render.bind(this));\r\n    renderLoop.start();\r\n};\r\n\r\nCore.prototype.onEachSecond = function(){\r\n    console.log('renderTicks: ', this.renderTicks);\r\n\r\n    if (this.renderTicks < 58 && this.resolutionCoefficient > 0.2){\r\n        this.resolutionCoefficient -= 0.1;\r\n        this.applyResolutionCoefficient();\r\n    } else if (this.renderTicks === 60 && this.resolutionCoefficient < 1) {\r\n        this.resolutionCoefficient += 0.1;\r\n        this.applyResolutionCoefficient();\r\n    }\r\n\r\n    this.renderTicks = 0;\r\n};\r\n\r\nCore.prototype.render = function(){\r\n    this.inputListener.update();\r\n    this.controlsHandler.update();\r\n    this.gameScene.update();\r\n    this.actorManager.update();\r\n    this.camera.update();\r\n    this.renderTicks++;\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.stats.update();\r\n};\r\n"]}